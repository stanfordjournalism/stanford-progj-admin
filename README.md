# stanford-progj-admin
- [Overview](#overview)
- [Setup](#setup)
- [Usage](#usage)
  - [Invites](#invites)
  - [Repos](#repos)

## Overview

Command-line utilities (using
[invoke](https://docs.pyinvoke.org/en/stable/)) to help
administer Stanford's Programming in Journalism course.

This repo helps manage student repositories generated by [cookiecutter-stanford-progj](https://github.com/stanfordjournalism/cookiecutter-stanford-progj), a [cookiecutter](https://cookiecutter.readthedocs.io/en/1.7.0/) template that helps students auto-generate separate private GitHub repositories for each assignment. The template also automatically invites instructors as collaborators on those repos.

This project aims to help instructors manage the large number of repos generated by this type of workflow (in lieu of a paid GitHub team account). It provides tasks that help with the following:

* Listing and accepting large numbers of collaboration [invites](#invites)
* Searching for and cloning large numbers of student [repositories](#repos)

## Setup

### Requirements

* git
* Python >= 3.5
* pipenv
* ssh public key added to GitHub
* A [personal GitHub API token](https://github.com/settings/tokens)

[Personal GitHub API token]: https://github.com/settings/tokens


### Install

```
git clone git@github.com:stanfordjournalism/stanford-progj-admin.git
cd stanford-progj-admin
pipenv install
```

Add your [personal GitHub API token][] to a project `.env` file:

```
# Fill in your own info for below variables
echo GITHUB_API_TOKEN=your_api_token >> .env
```

Optionally, if you'd like to search for student repos on GitHub based on a standardized search filter, set the `REPO_SEARCH_FILTER` environment variable. For example:

```
echo REPO_SEARCH_FILTER=comm-177p >> .env
```

The above setting is required by the `repos.search` task when it's not invoked with the `--custom-filter` option.


## Usage

```
# Activate env
cd stanford-progj-admin
pipenv shell

# See available commands
invoke --list
```

### Invites

The `invite` tasks help manage invitations to student repos on GitHub.

```
# List all available invites
invoke invites.list

# Accept all available invites
invoke invites.accept
```

### Repos

The `repos` tasks help search for and clone student repos on GitHub. The `repos.search` command conducts a search of repository names on GitHub. It is intended to help generate a text file that lists student repositories. This text file can then be fed to the `repos.clone` task to assist with cloning student work for grading.

See below for example usage.

```
# Search for repos based on REPO_SEARCH_FILTER environment variable
invoke repos.search

# Search for repos using a custom filter
invoke repos.search --custom-filter="comm-177p-assignment-1"

# Create a list of repos to clone
invoke repos.search --custom-filter="comm-177p-assignment-1" > assignment_1_repos.txt

# Clone student repos from a file
invoke repos.clone assignment_1_repos.txt
```